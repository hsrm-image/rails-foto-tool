%h1 Images
= form_for @image, :html => {:class => "dropzone", :id=>'upload'} do |f|
	.fallback
		= f.file_field :image_file, direct_upload: true
.img-container
	- @images.each do |image|
		= render image
:javascript
	var drop = undefined
	var input = document.querySelector('input[type=file]')
	if (!drop) {
		drop = new window.Dropzone('#upload', {
			paramName: 'image[image_file]',
		})
	}

	drop.on('addedfile', file => {
		const url = input.dataset.directUploadUrl
		const token = input.dataset.directUploadToken
		const attachmentName = input.dataset.directUploadAttachmentName
		file.title = file.filename
		console.log(file)
		console.log(url, token, attachmentName)
		const upload = new window.ActiveStorage.DirectUpload(
			file,
			url,
			token,
			attachmentName,
		)
		upload.create((error, blob) => {
			console.log('blob: ', blob)
			if (error) return
			console.log('direct-upload:success')
		})
	})
